<!DOCTYPE html>
<html lang="pt-BR">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Conta - Free Pigeon</title>
    <meta name="description" content="Crie sua conta no Free Pigeon e aproveite as melhores ofertas.">
    <link rel="stylesheet" href="{% static 'css/cadastro.css' %}">
</head>
<body>
    <div id="signup-app">
        <header class="signup-header">
            <div class="header-top">
                <a href="{% url 'home' %}" class="logo">
                    <img src="{% static 'img/freepigeon.png' %}" alt="Free Pigeon Logo" class="logo-icon"/>
                    <span class="logo-text">Free<br>Pigeon</span>
                </a>

                {% if veio_do_auth %}
                <a href="{% url 'auth' %}" class="back-link">
                    <i data-lucide="arrow-left"></i>
                    <span>Anterior</span>
                </a>
                {% endif %}
            </div>
            <h1 class="header-title">Crie sua conta e compre<br>com frete grátis!</h1>
        </header>

        <main class="signup-main">
            <div class="signup-card">

                <form method="POST">
                    {% csrf_token %}
                    <h2 class="form-title">Cadastro de Usuário</h2>

                    <!-- Nome -->
                    <div class="form-group">
                        <label for="nome">Nome</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <!-- Telefone -->
                    <div class="form-group">
                        <label for="telefone">Telefone</label>
                        <input
                            type="text"
                            id="telefone"
                            name="telefone"
                            maxlength="15"
                            inputmode="numeric"
                            placeholder="(11) 91234-5678">
                    </div>

                    <!-- CPF -->
                    <div class="form-group">
                        <label for="cpf">CPF</label>
                        <input
                            type="text"
                            id="cpf"
                            name="cpf"
                            maxlength="14"
                            inputmode="numeric"
                            placeholder="123.456.789-10">
                    </div>

                    <!-- Senha -->
                    <div class="form-group">
                        <label for="senha">Senha</label>
                        <input type="password" id="senha" name="senha" required>
                    </div>

                                        <!-- ESCOLHA DO PLANO -->
                    <div class="plan-section">
                        <div class="plan-section-header">
                            <h3>Escolha seu plano</h3>
                            <p>Você pode mudar de plano depois, na área de perfil.</p>
                        </div>

                        {% if planos %}
                        <div class="plan-options">
                            {% for plano in planos %}
                            <label class="plan-card {% if plano.is_default %}plan-card-default{% endif %}">
                                <!-- input para seleção do plano -->
                                <input
                                    type="radio"
                                    class="plan-radio"
                                    name="plano"
                                    value="{{ plano.slug }}"
                                    {% if plano.is_default %}checked{% endif %}
                                >

                                <div class="plan-card-inner">
                                    <div class="plan-card-header">
                                        <div class="plan-title">
                                            <span class="plan-name">{{ plano.nome }}</span>

                                            {% if plano.is_default %}
                                                <span class="plan-badge plan-badge-default">Plano gratuito</span>
                                            {% else %}
                                                <span class="plan-badge plan-badge-paid">Recomendado para vendedores</span>
                                            {% endif %}
                                        </div>

                                        <div class="plan-price">
                                            {% if plano.preco_mensal > 0 %}
                                                <strong>R$ {{ plano.preco_mensal|floatformat:2 }}</strong>
                                                <span class="price-period">/ mês</span>
                                            {% else %}
                                                <strong>Grátis</strong>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <p class="plan-desc">
                                        {{ plano.descricao|default:"Plano para vendedores do Free Pigeon." }}
                                    </p>

                                    <div class="plan-meta">
                                        {% if plano.limite_anuncios %}
                                            <span class="plan-limit">Até {{ plano.limite_anuncios }} anúncios ativos</span>
                                        {% else %}
                                            <span class="plan-limit">Anúncios ilimitados</span>
                                        {% endif %}

                                        {% if plano.preco_mensal > 0 %}
                                            <span class="plan-tag">Cobrança via Stripe na confirmação</span>
                                        {% else %}
                                            <span class="plan-tag plan-tag-free">Ideal para começar</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </label>
                            {% endfor %}
                        </div>
                        {% else %}
                            <p style="font-size:0.9rem; color:#6b7280; margin-top:0.5rem;">
                                Nenhum plano configurado. Contate o suporte.
                            </p>
                        {% endif %}
                    </div>


                    <!-- Consentimento -->
                    <div class="form-group-checkbox">
                        <input type="checkbox" id="contact-consent" name="contact-consent">
                        <label for="contact-consent">Aceito que entrem em contato comigo por SMS e WhatsApp.</label>
                    </div>

                    <p class="terms">
                        Ao clicar em “Cadastrar”, aceito os
                        <a href="#">termos e condições</a> e autorizo o uso dos meus dados de acordo com a
                        <a href="#">Declaração de privacidade</a>.
                    </p>

                    <!-- Botão principal -->
                    <button type="submit" class="btn-continue">Cadastrar</button>

                    <div class="divider">
                        <span>ou</span>
                    </div>

                    <!-- Botão Google (igual do login) -->
                    <a href="{% url 'social:begin' 'google-oauth2' %}" class="google-btn">
                        <img src="{% static 'img/google-icon.png' %}" alt="Google Logo">
                        Continuar com Google
                    </a>

                    {% if mensagem %}
                        <p class="success-message">{{ mensagem }}</p>
                    {% endif %}
                </form>

            </div>
        </main>
    </div>

    <script type="module" src="{% static 'js/signup.js' %}"></script>

    <!-- Máscaras CPF e Telefone -->
    <script>
        function somenteNumeros(str) {
            return (str || '').replace(/\D/g, '');
        }

        function mascaraCPF(value) {
            let v = somenteNumeros(value).slice(0, 11);
            if (v.length <= 3) return v;
            if (v.length <= 6) return v.replace(/(\d{3})(\d+)/, '$1.$2');
            if (v.length <= 9) return v.replace(/(\d{3})(\d{3})(\d+)/, '$1.$2.$3');
            return v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        function mascaraTelefone(value) {
            let v = somenteNumeros(value).slice(0, 11);

            if (v.length <= 2) return '(' + v;
            if (v.length <= 6) return v.replace(/(\d{2})(\d+)/, '($1) $2');
            if (v.length <= 10) return v.replace(/(\d{2})(\d{4})(\d+)/, '($1) $2-$3');
            return v.replace(/(\d{2})(\d{5})(\d+)/, '($1) $2-$3');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const cpfInput = document.getElementById('cpf');
            const telInput = document.getElementById('telefone');

            if (cpfInput) {
                cpfInput.addEventListener('input', function() {
                    const pos = this.selectionStart;
                    const old = this.value.length;

                    this.value = mascaraCPF(this.value);

                    const novo = this.value.length;
                    this.selectionStart = this.selectionEnd = pos + (novo - old);
                });
            }

            if (telInput) {
                telInput.addEventListener('input', function() {
                    const pos = this.selectionStart;
                    const old = this.value.length;

                    this.value = mascaraTelefone(this.value);

                    const novo = this.value.length;
                    this.selectionStart = this.selectionEnd = pos + (novo - old);
                });
            }
        });
    </script>
</body>
</html>
