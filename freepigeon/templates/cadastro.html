<!DOCTYPE html>
<html lang="pt-BR">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Conta - Free Pigeon</title>
    <meta name="description" content="Crie sua conta no Free Pigeon e aproveite as melhores ofertas.">
    <link rel="stylesheet" href="{% static 'css/cadastro.css' %}">
</head>
<body>
    <div id="signup-app">
        <header class="signup-header">
            <div class="header-top">
                <a href="{% url 'home' %}" class="logo">
                    <img src="{% static 'img/freepigeon.png' %}" alt="Free Pigeon Logo" class="logo-icon"/>
                    <span class="logo-text">Free<br>Pigeon</span>
                </a>
                <a href="{% url 'auth' %}" class="back-link">
                    <i data-lucide="arrow-left"></i>
                    <span>Anterior</span>
                </a>
            </div>
            <h1 class="header-title">Crie sua conta e compre<br>com frete grátis!</h1>
        </header>

        <main class="signup-main">
            <div class="signup-card">
                <form method="POST">
                    {% csrf_token %}
                    <h2 class="form-title">Cadastro de Usuário</h2>

                    <div class="form-group">
                        <label for="nome">Nome</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>

                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="telefone">Telefone</label>
                        <input
                            type="text"
                            id="telefone"
                            name="telefone"
                            required
                            maxlength="15"
                            inputmode="numeric"
                            placeholder="(11) 91234-5678">
                    </div>

                    <div class="form-group">
                        <label for="cpf">CPF</label>
                        <input
                            type="text"
                            id="cpf"
                            name="cpf"
                            required
                            maxlength="14"
                            inputmode="numeric"
                            placeholder="123.456.789-10">
                    </div>

                    <div class="form-group">
                        <label for="senha">Senha</label>
                        <input type="password" id="senha" name="senha" required>
                    </div>

                    <div class="form-group-checkbox">
                        <input type="checkbox" id="contact-consent" name="contact-consent">
                        <label for="contact-consent">Aceito que entrem em contato comigo por SMS e WhatsApp.</label>
                    </div>

                    <p class="terms">
                        Ao clicar em “Cadastrar”, aceito os
                        <a href="#">termos e condições</a> e autorizo o uso dos meus dados de acordo com a
                        <a href="#">Declaração de privacidade</a>.
                    </p>

                    <button type="submit" class="btn-continue">Cadastrar</button>

                    {% if mensagem %}
                        <p class="success-message">{{ mensagem }}</p>
                    {% endif %}
                </form>
            </div>
        </main>
    </div>

    <script type="module" src="{% static 'js/signup.js' %}"></script>

    <!-- Máscaras CPF e Telefone -->
    <script>
        function somenteNumeros(str) {
            return (str || '').replace(/\D/g, '');
        }

        function mascaraCPF(value) {
            let v = somenteNumeros(value).slice(0, 11);
            if (v.length <= 3) return v;
            if (v.length <= 6) return v.replace(/(\d{3})(\d+)/, '$1.$2');
            if (v.length <= 9) return v.replace(/(\d{3})(\d{3})(\d+)/, '$1.$2.$3');
            return v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        function mascaraTelefone(value) {
            let v = somenteNumeros(value).slice(0, 11);

            if (v.length <= 2) {
                return '(' + v;
            }
            if (v.length <= 6) {
                return v.replace(/(\d{2})(\d+)/, '($1) $2');
            }
            if (v.length <= 10) {
                // Fixo: (11) 1234-5678
                return v.replace(/(\d{2})(\d{4})(\d+)/, '($1) $2-$3');
            }
            // Celular: (11) 91234-5678
            return v.replace(/(\d{2})(\d{5})(\d+)/, '($1) $2-$3');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const cpfInput = document.getElementById('cpf');
            const telInput = document.getElementById('telefone');

            if (cpfInput) {
                cpfInput.addEventListener('input', function() {
                    const cursorPos = this.selectionStart;
                    const oldLength = this.value.length;

                    this.value = mascaraCPF(this.value);

                    const newLength = this.value.length;
                    this.selectionStart = this.selectionEnd = cursorPos + (newLength - oldLength);
                });
            }

            if (telInput) {
                telInput.addEventListener('input', function() {
                    const cursorPos = this.selectionStart;
                    const oldLength = this.value.length;

                    this.value = mascaraTelefone(this.value);

                    const newLength = this.value.length;
                    this.selectionStart = this.selectionEnd = cursorPos + (newLength - oldLength);
                });
            }
        });
    </script>
</body>
</html>
