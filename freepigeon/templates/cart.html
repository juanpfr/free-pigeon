{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrinho - Free Pigeon</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/cart.css' %}">
</head>

<body>
  <div id="app">
    {% include 'partials/header.html' %}

    <main class="cart-main">
      {% if itens %}
      <div class="cart-wrapper">

        <!-- Coluna principal: itens -->
        <section class="cart-box">
          <header class="cart-box-header">
            <div>
              <h1>Seu carrinho</h1>
              <p class="cart-subtitle">
                {{ total_itens }} item{{ total_itens|pluralize }} no carrinho
              </p>
            </div>
            <a href="{% url 'home' %}" class="cart-link-light">Continuar comprando</a>
          </header>

          <!-- Cabe√ßalho tipo tabela -->
          <div class="cart-items-header">
            <span class="col-produto">Produto</span>
            <span class="col-preco">Pre√ßo</span>
            <span class="col-qtd">Quantidade</span>
            <span class="col-subtotal">Subtotal</span>
          </div>

          <div class="cart-items-list">
            {% for item in itens %}
            <article class="cart-item-row">
              <!-- Produto + imagem -->
              <div class="cart-item-product">
                <div class="cart-item-thumb">
                  {% if item.produto.imagem %}
                  <img src="{{ item.produto.imagem.url }}" alt="{{ item.produto.nome }}">
                  {% else %}
                  <img src="{% static 'img/sem-imagem.png' %}" alt="{{ item.produto.nome }}">
                  {% endif %}
                </div>

                <div class="cart-item-info">
                  <h2 class="cart-item-title">
                    <a href="{% url 'produto' item.produto.id %}">
                      {{ item.produto.nome }}
                    </a>
                  </h2>

                  <p class="cart-item-meta">
                    Categoria: {{ item.produto.categoria.nome }}
                  </p>

                  <div class="cart-item-extra">
                    {% if item.produto.tamanho %}
                    <span>Tamanho: {{ item.produto.tamanho }}</span>
                    {% endif %}
                    {% if item.produto.tensao %}
                    <span>Tens√£o: {{ item.produto.tensao }}</span>
                    {% endif %}
                    {% if item.produto.comprimento %}
                    <span>Comprimento: {{ item.produto.comprimento }} cm</span>
                    {% endif %}
                  </div>

                  <button class="cart-link-danger"
                    onclick="if(confirm('Voc√™ deseja mesmo remover este item do carrinho?')) { this.closest('form').submit(); }"
                    type="button">
                    Remover
                  </button>
                  <form action="{% url 'remover_do_carrinho' item.produto.id %}" method="post" style="display:none;">
                    {% csrf_token %}
                  </form>
                </div>
              </div>

              <!-- Pre√ßo unit√°rio -->
              <div class="cart-item-price">
                {% if item.produto.desconto %}
                <div class="price-with-discount">
                  <span class="old-price">R$ {{ item.produto.valor|floatformat:2 }}</span>
                  <span class="new-price">R$ {{ item.produto.preco_final|floatformat:2 }}</span>
                  <span class="discount-pill">
                    -{{ item.produto.desconto|floatformat:0 }}%
                  </span>
                </div>
                {% else %}
                <span class="new-price">
                  R$ {{ item.produto.valor|floatformat:2 }}
                </span>
                {% endif %}
              </div>

              <!-- Quantidade -->
              <div class="cart-item-qty">
                <div class="qty-pill">
                  {{ item.quantidade }}
                </div>
                <small class="qty-note">
                  Ajustar quantidade pela p√°gina do produto
                </small>
              </div>

              <!-- Subtotal -->
              <div class="cart-item-subtotal">
                <span>Total</span>
                <strong>R$ {{ item.subtotal|floatformat:2 }}</strong>
              </div>
            </article>
            {% endfor %}
          </div>

          <div class="cart-bottom-actions">
            <a href="{% url 'home' %}" class="cart-link-light">
              ‚üµ Escolher mais produtos
            </a>
          </div>
        </section>

        <!-- Coluna lateral: resumo -->
        <aside class="cart-summary">
          <div class="summary-card">
            <h2>Resumo da compra</h2>

            <div class="summary-row">
              <span>Itens ({{ total_itens }})</span>
              <span>R$ {{ subtotal|floatformat:2 }}</span>
            </div>

            {% if frete and frete > 0 %}
            <div class="summary-row">
              <span>Frete</span>
              <span>R$ {{ frete|floatformat:2 }}</span>
            </div>
            {% else %}
            <div class="summary-row">
              <span>Frete</span>
              <span class="summary-info">A calcular no pr√≥ximo passo</span>
            </div>
            {% endif %}

            <div class="summary-divider"></div>

            <div class="summary-row summary-total">
              <span>Total</span>
              <span class="summary-total-value">
                R$ {{ total|floatformat:2 }}
              </span>
            </div>

            <a href="{% url 'checkout' %}" class="btn-checkout">
              Finalizar compra
            </a>

            <p class="summary-note">
              Voc√™ poder√° escolher endere√ßo e calcular o frete na pr√≥xima etapa.
            </p>
          </div>
        </aside>
      </div>

      {% else %}
      <!-- Carrinho vazio -->
      <section class="cart-empty">
        <div class="cart-empty-card">
          <h2>Seu carrinho est√° vazio üõí</h2>
          <p>Voc√™ ainda n√£o adicionou nenhum produto.</p>
          <a href="{% url 'home' %}" class="btn-empty-cta">
            Ver produtos
          </a>
        </div>
      </section>
      {% endif %}
    </main>

    {% include 'partials/footer.html' %}
  </div>

  <script src="{% static 'js/main.js' %}"></script>
</body>

</html>