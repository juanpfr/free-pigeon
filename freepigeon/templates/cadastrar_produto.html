{% extends 'base.html' %}
{% load static %}

{% block content %}
<main>
    <section class="product-section">
        <h2>Cadastrar novo produto</h2>

        <div style="max-width: 800px; margin: 0 auto;">
            <div class="product-card" style="border-radius: 20px; padding: 1.8rem 2rem;">

                <p style="font-size: 14px; color: var(--text-gray); margin-bottom: 1.2rem;">
                    Crie um novo anúncio para vender no FreePigeon.
                    {% if usuario.loja %}
                        Você pode vincular este produto à sua loja <strong>{{ usuario.loja.nome }}</strong>
                        ou apenas à sua conta de vendedor.
                    {% else %}
                        Ele ficará vinculado apenas à sua conta (sem loja).
                    {% endif %}
                </p>

                <form method="post" action="{% url 'cadastrar_produto' %}" enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- NOME -->
                    <div style="margin-bottom: 1rem;">
                        <label for="nome" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                            Título do anúncio
                        </label>
                        <input
                            type="text"
                            id="nome"
                            name="nome"
                            required
                            placeholder="Ex: iPhone 12 128GB seminovo"
                            style="
                                width: 100%;
                                padding: .7rem .9rem;
                                border-radius: 8px;
                                border: 1px solid var(--border-gray);
                                font-size: 14px;
                                outline: none;
                            ">
                    </div>

                    <!-- CATEGORIA -->
                    <div style="margin-bottom: 1rem;">
                        <label for="categoria" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                            Categoria
                        </label>
                        <select
                            id="categoria"
                            name="categoria"
                            required
                            style="
                                width: 100%;
                                padding: .7rem .9rem;
                                border-radius: 8px;
                                border: 1px solid var(--border-gray);
                                font-size: 14px;
                                background-color: var(--bg-white);
                            ">
                            <option value="">Selecione uma categoria</option>
                            {% for categoria in categorias %}
                                <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- DESCRIÇÃO -->
                    <div style="margin-bottom: 1rem;">
                        <label for="descricao" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                            Descrição
                        </label>
                        <textarea
                            id="descricao"
                            name="descricao"
                            rows="4"
                            placeholder="Descreva o estado do produto, o que acompanha, detalhes importantes..."
                            style="
                                width: 100%;
                                padding: .7rem .9rem;
                                border-radius: 8px;
                                border: 1px solid var(--border-gray);
                                font-size: 14px;
                                outline: none;
                                resize: vertical;
                            "></textarea>
                    </div>

                    <!-- PREÇO E DESCONTO -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label for="valor" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                                Preço (R$)
                            </label>
                            <input
                                type="number"
                                step="0.01"
                                min="0"
                                id="valor"
                                name="valor"
                                required
                                placeholder="Ex: 1299,90"
                                style="
                                    width: 100%;
                                    padding: .7rem .9rem;
                                    border-radius: 8px;
                                    border: 1px solid var(--border-gray);
                                    font-size: 14px;
                                    outline: none;
                                ">
                        </div>
                        <div>
                            <label for="desconto" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                                Desconto (%)
                            </label>
                            <input
                                type="number"
                                step="0.01"
                                min="0"
                                max="100"
                                id="desconto"
                                name="desconto"
                                placeholder="Opcional"
                                style="
                                    width: 100%;
                                    padding: .7rem .9rem;
                                    border-radius: 8px;
                                    border: 1px solid var(--border-gray);
                                    font-size: 14px;
                                    outline: none;
                                ">
                        </div>
                        <div>
                            <label for="q_estoque" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                                Estoque
                            </label>
                            <input
                                type="number"
                                min="1"
                                id="q_estoque"
                                name="q_estoque"
                                required
                                placeholder="Quantidade disponível"
                                style="
                                    width: 100%;
                                    padding: .7rem .9rem;
                                    border-radius: 8px;
                                    border: 1px solid var(--border-gray);
                                    font-size: 14px;
                                    outline: none;
                                ">
                        </div>
                    </div>

                    <!-- IMAGEM -->
                    <div style="margin-bottom: 1rem;">
                        <label for="imagem" style="display: block; font-size: 13px; font-weight: 500; color: var(--text-gray-dark); margin-bottom: 0.3rem;">
                            Imagem principal
                        </label>
                        <input
                            type="file"
                            id="imagem"
                            name="imagem"
                            accept="image/*"
                            style="font-size: 13px;">
                        <p style="font-size: 12px; color: var(--text-gray-light); margin-top: .3rem;">
                            Use imagens claras, em boa resolução, mostrando bem o produto.
                        </p>
                    </div>

                    <!-- VINCULAR À LOJA -->
                    {% if usuario.loja %}
                        <div style="margin-bottom: 1rem; padding: .8rem 1rem; border-radius: 10px; background-color: #f7f7f7;">
                            <label style="display: flex; align-items: center; gap: .5rem; font-size: 14px; color: var(--text-gray-dark); cursor: pointer;">
                                <input
                                    type="checkbox"
                                    name="vincular_loja"
                                    value="1"
                                    checked
                                    style="transform: scale(1.1);">
                                Vincular este produto à minha loja
                                <strong>{{ usuario.loja.nome }}</strong>
                            </label>
                        </div>
                    {% endif %}

                    {% if messages %}
                        <ul style="font-size: 13px; color: var(--primary-blue); margin-bottom: 1rem; list-style: none;">
                            {% for message in messages %}
                                <li>{{ message }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}

                    <div style="display: flex; gap: .8rem; flex-wrap: wrap; margin-top: 1rem;">
                        <button type="submit" style="
                            padding: .8rem 1.6rem;
                            border-radius: 8px;
                            background-color: var(--primary-blue);
                            color: var(--bg-white);
                            font-size: 14px;
                            font-weight: 500;
                            ">
                            Publicar anúncio
                        </button>

                        <a href="{% url 'vender' %}" style="
                            padding: .8rem 1.6rem;
                            border-radius: 8px;
                            border: 1px solid var(--border-gray);
                            font-size: 14px;
                            ">
                            Voltar para área do vendedor
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>
{% endblock %}
