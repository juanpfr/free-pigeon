{% extends 'base.html' %}
{% load static %}

{% block content %}
<main>
    <section class="product-section" style="max-width: 900px; margin: 0 auto;">
        <h2>Meus endereços</h2>

        <!-- LISTA DE ENDEREÇOS -->
        <div class="product-card" style="border-radius: 20px; margin-top:1rem;">
            <h3 style="font-size:16px; margin-bottom:1rem;">Endereços cadastrados</h3>

            {% if enderecos %}
                <div style="display:flex; flex-direction:column; gap:.75rem; font-size:14px;">
                    {% for endereco in enderecos %}
                        <div style="padding:.75rem 1rem; border-radius:12px; border:1px solid var(--border-gray);">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    {% if endereco.apelido %}
                                        <strong>{{ endereco.apelido }}</strong>
                                    {% else %}
                                        <strong>Endereço {{ forloop.counter }}</strong>
                                    {% endif %}
                                    {% if endereco.principal %}
                                        <span style="font-size:11px; padding:2px 6px; border-radius:999px; background:var(--primary-green); margin-left:.5rem;">
                                            Principal
                                        </span>
                                    {% endif %}
                                </div>
                                <div style="display:flex; gap:.5rem;">
                                    <a href="{% url 'editar_endereco' endereco.id %}" style="font-size:13px; text-decoration:underline;">
                                        Editar
                                    </a>
                                    <form method="post" action="{% url 'excluir_endereco' endereco.id %}">
                                        {% csrf_token %}
                                        <button type="submit" style="background:none; border:none; font-size:13px; text-decoration:underline; cursor:pointer;">
                                            Excluir
                                        </button>
                                    </form>
                                    {% if not endereco.principal %}
                                        <a href="{% url 'definir_endereco_principal' endereco.id %}" style="font-size:13px; text-decoration:underline;">
                                            Tornar principal
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                            <p style="margin-top:.25rem;">
                                {{ endereco.rua }}, {{ endereco.numero }}
                                {% if endereco.complemento %}- {{ endereco.complemento }}{% endif %}
                            </p>
                            <p style="color:var(--text-gray);">
                                {{ endereco.bairro }} - {{ endereco.cidade }} / {{ endereco.estado }}<br>
                                CEP: {{ endereco.cep }}
                            </p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p style="font-size:14px; color:var(--text-gray);">
                    Você ainda não tem endereços cadastrados.
                </p>
            {% endif %}
        </div>

        <!-- FORMULÁRIO DE NOVO ENDEREÇO -->
        <form method="post" class="product-card" style="border-radius:20px; margin-top:1.5rem;">
            {% csrf_token %}
            <h3 style="font-size:16px; margin-bottom:1rem;">Adicionar novo endereço</h3>

            <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem 2rem; font-size:14px;">
                <div>
                    <label>Apelido (opcional)</label><br>
                    <input type="text" name="apelido" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Rua *</label><br>
                    <input type="text" name="rua" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Número *</label><br>
                    <input type="number" name="numero" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Complemento</label><br>
                    <input type="text" name="complemento" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Bairro *</label><br>
                    <input type="text" name="bairro" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Cidade *</label><br>
                    <input type="text" name="cidade" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>Estado *</label><br>
                    <input type="text" name="estado" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
                <div>
                    <label>CEP *</label><br>
                    <input type="text" name="cep" style="width:100%; padding:.6rem; border-radius:8px; border:1px solid var(--border-gray);">
                </div>
            </div>

            <div style="margin-top:1rem;">
                <label style="font-size:13px;">
                    <input type="checkbox" name="principal" value="1">
                    Definir como endereço principal
                </label>
            </div>

            <div style="margin-top: 1.5rem; display:flex; gap:1rem;">
                <button type="submit" style="
                    padding:.7rem 1.4rem;
                    border-radius:8px;
                    background:var(--primary-green);
                    font-weight:500;
                    ">
                    Salvar endereço
                </button>
                <a href="{% url 'perfil' %}" style="padding:.7rem 1.4rem; border-radius:8px; border:1px solid var(--border-gray); text-decoration:none;">
                    Voltar ao perfil
                </a>
            </div>
        </form>
    </section>
</main>
{% endblock %}
